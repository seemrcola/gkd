import{_ as F}from"./Card.vue_vue_type_script_setup_true_lang-D0KoHxV7.js";import{r as p,s as M,h as O,v as z,x as J,d as B,y as G,z as K,u as A,a as C,c as _,A as P,n as U,b as $,w as W,e as w,B as H,F as Q,i as X,t as I,C as j}from"./index-CSbb4QqH.js";import{c as q}from"./utils-CytzSlOG.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Y=r=>typeof r<"u";function Z(r){return JSON.parse(JSON.stringify(r))}function ee(r,l,f,u={}){var s,a,v;const{clone:m=!1,passive:h=!1,eventName:g,deep:y=!1,defaultValue:V,shouldEmit:S}=u,i=z(),k=f||(i==null?void 0:i.emit)||((s=i==null?void 0:i.$emit)==null?void 0:s.bind(i))||((v=(a=i==null?void 0:i.proxy)==null?void 0:a.$emit)==null?void 0:v.bind(i==null?void 0:i.proxy));let b=g;b=b||`update:${l.toString()}`;const E=e=>m?typeof m=="function"?m(e):Z(e):e,N=()=>Y(r[l])?E(r[l]):V,T=e=>{S?S(e)&&k(b,e):k(b,e)};if(h){const e=N(),t=p(e);let n=!1;return M(()=>r[l],o=>{n||(n=!0,t.value=E(o),J(()=>n=!1))}),M(t,o=>{!n&&(o!==r[l]||y)&&T(o)},{deep:y}),t}else return O({get(){return N()},set(e){T(e)}})}const te=B({__name:"Input",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(r,{emit:l}){const f=r,s=ee(f,"modelValue",l,{passive:!0,defaultValue:f.defaultValue});return(a,v)=>G((C(),_("input",{"onUpdate:modelValue":v[0]||(v[0]=m=>P(s)?s.value=m:null),class:U(A(q)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",f.class))},null,2)),[[K,A(s)]])}}),L=[{id:1,name:"Alice",avatar:"👩"},{id:2,name:"Bob",avatar:"👨"},{id:3,name:"Charlie",avatar:"👨‍🦰"},{id:4,name:"David",avatar:"👨‍🦱"},{id:5,name:"Eva",avatar:"👩‍🦰"},{id:6,name:"Fiona",avatar:"👩‍🦰"},{id:7,name:"Gina",avatar:"👩‍🦰"},{id:8,name:"Hannah",avatar:"👩‍🦰"},{id:9,name:"Ivy",avatar:"👩‍🦰"},{id:10,name:"Julia",avatar:"👩‍🦰"}],ne={class:"container mx-auto p-6 max-w-2xl space-y-6"},ae={class:"relative"},oe={class:"sticky top-0 p-1.5 border-b border-border bg-popover"},le=["onClick","onMouseover"],se={class:"text-base"},ce=B({__name:"index",setup(r){const l=p(),f=p(),u=p(!1),s=p(""),a=p(-1),v=p(""),m=p(""),h=p({top:0,left:0}),g=O(()=>s.value?L.filter(e=>e.name.toLowerCase().includes(s.value.toLowerCase())):L);function y(e){if(u.value)switch(e.key){case"ArrowUp":e.preventDefault(),a.value===-1?a.value=g.value.length-1:a.value=a.value>0?a.value-1:g.value.length-1,V();break;case"ArrowDown":e.preventDefault(),a.value===-1?a.value=0:a.value=a.value<g.value.length-1?a.value+1:0,V();break;case"Enter":e.preventDefault(),a.value!==-1&&g.value.length>0&&b(g.value[a.value]);break;case"Escape":u.value=!1;break}}function V(){if(!f.value)return;const e=f.value.children[a.value];e&&e.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}function S(){i(),T(),k()}function i(){var D,R;if(!l.value)return;const e=window.getSelection();if(!e||!e.rangeCount)return;const t=e.getRangeAt(0);let n="",o="";const x=Array.from(l.value.childNodes);let c=!1;for(const d of x)d===t.startContainer||d.contains(t.startContainer)?(d.nodeType===Node.TEXT_NODE?(n+=((D=d.textContent)==null?void 0:D.slice(0,t.startOffset))||"",o+=((R=d.textContent)==null?void 0:R.slice(t.startOffset))||""):d.nodeType===Node.ELEMENT_NODE&&(c?o+=d.textContent:n+=d.textContent),c=!0):c?o+=d.textContent:n+=d.textContent;v.value=n,m.value=o}function k(){m.value===""&&v.value.slice(-1)==="@"||v.value.slice(-1)==="@"?(u.value=!0,s.value="",a.value=-1):u.value=!1}function b(e){if(!l.value)return;const t=window.getSelection();if(!t||!t.rangeCount)return;const n=t.getRangeAt(0);E(e,n),u.value=!1,s.value="",a.value=-1}function E(e,t){const n=N(e.name);t.setStart(t.startContainer,t.startOffset-1),t.deleteContents(),t.insertNode(n);const o=document.createTextNode(" ");n.after(o);const x=document.createRange();x.setStartAfter(o),x.setEndAfter(o);const c=window.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(x)}function N(e){const t=document.createElement("span");return t.textContent=`@${e}`,t.contentEditable="false",t.classList.add("text-blue-500","bg-gray-100/70","font-bold","rounded-md","px-1","py-0.5"),t}function T(){if(!l.value)return;const e=window.getSelection();if(!e||!e.rangeCount)return;const n=e.getRangeAt(0).getBoundingClientRect(),o=l.value.getBoundingClientRect();h.value={top:n.bottom-o.top,left:n.left-o.left}}return(e,t)=>(C(),_("div",ne,[$(A(F),{class:"p-6"},{default:W(()=>[t[1]||(t[1]=w("h2",{class:"text-2xl font-bold mb-4"}," Mention 演示 ",-1)),w("div",ae,[w("div",{ref_key:"editor",ref:l,contenteditable:"true",class:"min-h-[100px] w-full p-3 rounded-lg border border-input focus:outline-none focus:ring-2 focus:ring-ring whitespace-pre-wrap break-words",placeholder:"输入 @ 来提及用户...",onInput:S,onKeydown:y},null,544),u.value?(C(),_("div",{key:0,class:"absolute z-50 bg-popover rounded-lg shadow-lg border border-border overflow-hidden",style:H({top:`${h.value.top}px`,left:`${h.value.left}px`,width:"200px"})},[w("div",oe,[$(A(te),{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=n=>s.value=n),placeholder:"搜索用户...",class:"w-full h-7 text-sm"},null,8,["modelValue"])]),w("div",{ref_key:"userListContainer",ref:f,class:"max-h-[160px] overflow-y-auto py-1"},[(C(!0),_(Q,null,X(g.value,(n,o)=>(C(),_("div",{key:n.id,class:U(["px-2 py-1 hover:bg-accent cursor-pointer flex items-center gap-2 text-sm",{"bg-accent":o===a.value}]),onClick:x=>b(n),onMouseover:x=>a.value=o},[w("span",se,I(n.avatar),1),w("span",null,I(n.name),1)],42,le))),128))],512)],4)):j("",!0)])]),_:1})]))}});export{ce as default};
