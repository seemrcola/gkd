import{x as S,o as V,n as G,a as j,t as E,_ as M}from"./index-Br87ZoBF.js";import{_ as A}from"./Card.vue_vue_type_script_setup_true_lang-D0KoHxV7.js";import{c as N}from"./utils-CytzSlOG.js";import{d as k,h as R,a as w,f as b,w as x,b as p,u as c,c as P,i as W,F as $,m as q,r as F,j as D,o as L,k as z,e as g,g as H,t as O}from"./index-CSbb4QqH.js";const U=k({__name:"Slider",props:{name:{},defaultValue:{},modelValue:{},disabled:{type:Boolean},orientation:{},dir:{},inverted:{type:Boolean},min:{},max:{},step:{},minStepsBetweenThumbs:{},asChild:{type:Boolean},as:{},class:{}},emits:["update:modelValue","valueCommit"],setup(h,{emit:t}){const a=h,s=t,o=R(()=>{const{class:d,...i}=a;return i}),u=S(o,s);return(d,i)=>(w(),b(c(E),q({class:c(N)("relative flex w-full touch-none select-none items-center data-[orientation=vertical]:flex-col data-[orientation=vertical]:w-2 data-[orientation=vertical]:h-full",a.class)},c(u)),{default:x(()=>[p(c(G),{class:"relative h-2 w-full data-[orientation=vertical]:w-2 grow overflow-hidden rounded-full bg-secondary"},{default:x(()=>[p(c(V),{class:"absolute h-full data-[orientation=vertical]:w-full bg-primary"})]),_:1}),(w(!0),P($,null,W(d.modelValue,(r,n)=>(w(),b(c(j),{key:n,class:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"}))),128))]),_:1},16,["class"]))}});function J(h){const t=[],a={isPlaying:!1,progress:0,currentFrameIndex:0};let s=null,o=0;const u=new Set;function d(){u.forEach(e=>e({...a}))}function i(e){Object.assign(a,e),d()}async function r(e,m=50){let l=e.tracks.selectedTrack,f=0;for(;!l&&f<m;)await new Promise(y=>setTimeout(y,100)),l=e.tracks.selectedTrack,f++,console.log("Waiting for track, attempt:",f);if(!l)throw new Error("Failed to get track after retries");return console.log("Track initialized:",l,"Frame count:",l.frameCount),l}function n(){const e=performance.now(),m=t[a.currentFrameIndex];e-o>=m.duration&&(i({currentFrameIndex:(a.currentFrameIndex+1)%t.length,progress:(a.currentFrameIndex+1)/t.length*100}),o=e),a.isPlaying&&(s=requestAnimationFrame(n))}async function v(){try{const e=new window.ImageDecoder({data:h,type:"image/gif"});await e.completed;const l=(await r(e)).frameCount;for(let f=0;f<l;f++){const y=await e.decode({frameIndex:f});t.push({image:y.image,duration:y.duration||100})}console.log("GIF 解码完成:",t.length)}catch(e){console.error("GIF 解码错误:",e)}}function I(){a.isPlaying||t.length===0||(i({isPlaying:!0}),o=performance.now(),n())}function _(){i({isPlaying:!1}),s&&cancelAnimationFrame(s)}function C(){var e;return(e=t[a.currentFrameIndex])==null?void 0:e.image}function B(e){const m=Math.floor(e/100*t.length);i({currentFrameIndex:Math.min(Math.max(m,0),t.length-1),progress:e})}function T(){_(),t.forEach(e=>e.image.close()),t.length=0}return{state:a,init:v,play:I,pause:_,getCurrentFrame:C,setProgress:B,dispose:T,subscribe(e){return u.add(e),()=>u.delete(e)}}}const K={class:"container mx-auto p-6 max-w-2xl space-y-6"},Q={class:"space-y-4"},X={class:"relative aspect-video bg-black/5 rounded-lg overflow-hidden flex justify-center items-center"},Y={class:"space-y-2"},Z={class:"flex items-center gap-4"},re=k({__name:"index",setup(h){const t=F(),a=F(),s=D({isPlaying:!1,progress:0});let o;async function u(){try{const n=await(await fetch("/example.gif")).arrayBuffer();a.value=J(n),o=a.value.subscribe(v=>{s.isPlaying=v.isPlaying,s.progress=v.progress}),await a.value.init(),d()}catch(r){console.error("Failed to load GIF:",r)}}function d(){if(!t.value||!a.value)return;const r=t.value.getContext("2d");if(!r)return;const n=a.value.getCurrentFrame();n&&(t.value.width!==n.displayWidth&&(t.value.width=n.displayWidth,t.value.height=n.displayHeight),r.clearRect(0,0,t.value.width,t.value.height),r.drawImage(n,0,0)),requestAnimationFrame(d)}function i(){a.value&&(a.value.state.isPlaying?a.value.pause():a.value.play())}return L(()=>{u()}),z(()=>{var r;o==null||o(),(r=a.value)==null||r.dispose()}),(r,n)=>(w(),P("div",K,[p(c(A),{class:"p-6"},{default:x(()=>[g("div",Q,[n[0]||(n[0]=g("h2",{class:"text-2xl font-bold"}," GIF 播放器 ",-1)),g("div",X,[g("canvas",{ref_key:"canvasRef",ref:t,class:"max-w-full max-h-full object-contain"},null,512)]),g("div",Y,[g("div",Z,[p(c(M),{onClick:i},{default:x(()=>[H(O(s.isPlaying?"暂停":"播放"),1)]),_:1}),p(c(U),{"model-value":[s.progress],min:0,max:100,step:.1,class:"flex-1",disabled:!0},null,8,["model-value"])])])])]),_:1})]))}});export{re as default};
